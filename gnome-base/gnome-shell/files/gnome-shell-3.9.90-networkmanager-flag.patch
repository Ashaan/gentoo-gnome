diff -Nuar -Naur gnome-shell-3.9.90.origin/configure.ac gnome-shell-3.9.90/configure.ac
--- gnome-shell-3.9.90.origin/configure.ac	2013-09-03 11:08:45.364010409 +0400
+++ gnome-shell-3.9.90/configure.ac	2013-09-03 11:25:12.571599529 +0400
@@ -95,8 +95,6 @@
 			       libcanberra libcanberra-gtk3
                                telepathy-glib >= $TELEPATHY_GLIB_MIN_VERSION
                                polkit-agent-1 >= $POLKIT_MIN_VERSION
-                               libnm-glib libnm-util >= $NETWORKMANAGER_MIN_VERSION
-                               libnm-gtk >= $NETWORKMANAGER_MIN_VERSION
                                libsecret-unstable gcr-base-3 >= $GCR_MIN_VERSION)
 
 PKG_CHECK_MODULES(GNOME_SHELL_JS, gio-2.0 gjs-internals-1.0 >= $GJS_MIN_VERSION)
@@ -160,6 +158,38 @@
             [Define if _NL_TIME_FIRST_WEEKDAY is available])
 fi
 
+AC_ARG_ENABLE(networkmanager,
+             AS_HELP_STRING([--disable-networkmanager],
+                            [disable NetworkManager support  @<:@default=auto@:>@]),,
+              [enable_networkmanager=auto])
+
+if test "x$enable_networkmanager" != "xno"; then
+   PKG_CHECK_MODULES(NETWORKMANAGER,
+                     [libnm-glib 
+                     libnm-util >= $NETWORKMANAGER_MIN_VERSION
+                     libnm-gtk >= $NETWORKMANAGER_MIN_VERSION 
+                     gnome-keyring-1],
+                     [have_networkmanager=yes],
+                     [have_networkmanager=no])
+
+   GNOME_SHELL_CFLAGS="$GNOME_SHELL_CFLAGS $NETWORKMANAGER_CFLAGS"
+   GNOME_SHELL_LIBS="$GNOME_SHELL_LIBS $NETWORKMANAGER_LIBS"
+else
+   have_networkmanager="no  (disabled)"
+fi
+
+if test "x$have_networkmanager" = "xyes"; then
+   AC_DEFINE(HAVE_NETWORKMANAGER, [1], [Define if we have NetworkManager])
+   AC_SUBST([HAVE_NETWORKMANAGER], [1])
+else
+   if test "x$enable_networkmanager" = "xyes"; then
+      AC_MSG_ERROR([Couldn't find NetworkManager.])
+   fi
+   AC_SUBST([HAVE_NETWORKMANAGER], [0])
+fi
+
+AM_CONDITIONAL(HAVE_NETWORKMANAGER, test "$have_networkmanager" = "yes")
+
 # Sets GLIB_GENMARSHAL and GLIB_MKENUMS
 AM_PATH_GLIB_2_0()
 
@@ -205,3 +235,16 @@
   man/Makefile
 ])
 AC_OUTPUT
+
+echo "
+Build configuration:
+
+       Prefix:                                 ${prefix}
+       Source code location:                   ${srcdir}
+       Compiler:                               ${CC}
+       Compiler Warnings:                      $enable_compile_warnings
+
+       Support for NetworkManager:             $have_networkmanager
+       Support for GStreamer recording:        $build_recorder
+"
+
diff -Nuar -Naur gnome-shell-3.9.90.origin/js/Makefile.am gnome-shell-3.9.90/js/Makefile.am
--- gnome-shell-3.9.90.origin/js/Makefile.am	2013-09-03 11:08:45.334010786 +0400
+++ gnome-shell-3.9.90/js/Makefile.am	2013-09-03 11:25:15.991556534 +0400
@@ -8,6 +8,7 @@
 	sed -e "s|[@]PACKAGE_NAME@|$(PACKAGE_NAME)|g" \
 	    -e "s|[@]PACKAGE_VERSION@|$(PACKAGE_VERSION)|g" \
 	    -e "s|[@]HAVE_BLUETOOTH@|$(HAVE_BLUETOOTH)|g" \
+        -e "s|[@]HAVE_NETWORKMANAGER@|$(HAVE_NETWORKMANAGER)|g" \
 	    -e "s|[@]GETTEXT_PACKAGE@|$(GETTEXT_PACKAGE)|g" \
 	    -e "s|[@]datadir@|$(datadir)|g" \
 	    -e "s|[@]libexecdir@|$(libexecdir)|g" \
diff -Nuar -Naur gnome-shell-3.9.90.origin/js/misc/config.js.in gnome-shell-3.9.90/js/misc/config.js.in
--- gnome-shell-3.9.90.origin/js/misc/config.js.in	2013-09-03 11:08:45.334010786 +0400
+++ gnome-shell-3.9.90/js/misc/config.js.in	2013-09-03 11:25:16.001556408 +0400
@@ -6,6 +6,8 @@
 const PACKAGE_VERSION = '@PACKAGE_VERSION@';
 /* 1 if gnome-bluetooth is available, 0 otherwise */
 const HAVE_BLUETOOTH = @HAVE_BLUETOOTH@;
+/* 1 if networkmanager is available, 0 otherwise */
+const HAVE_NETWORKMANAGER = @HAVE_NETWORKMANAGER@;
 /* gettext package */
 const GETTEXT_PACKAGE = '@GETTEXT_PACKAGE@';
 /* locale dir */
diff -Nuar -Naur gnome-shell-3.9.90.origin/js/ui/panel.js gnome-shell-3.9.90/js/ui/panel.js
--- gnome-shell-3.9.90.origin/js/ui/panel.js	2013-09-03 11:08:45.344010660 +0400
+++ gnome-shell-3.9.90/js/ui/panel.js	2013-09-03 11:25:16.071555528 +0400
@@ -808,8 +808,6 @@
         this._indicators = new St.BoxLayout({ style_class: 'panel-status-indicators-box' });
         this.actor.add_child(this._indicators);
 
-        this._network = new imports.ui.status.network.NMApplet();
-        this._bluetooth = new imports.ui.status.bluetooth.Indicator();
         this._power = new imports.ui.status.power.Indicator();
         this._rfkill = new imports.ui.status.rfkill.Indicator();
         this._volume = new imports.ui.status.volume.Indicator();
@@ -818,8 +816,6 @@
         this._screencast = new imports.ui.status.screencast.Indicator();
 
         this._indicators.add_child(this._screencast.indicators);
-        this._indicators.add_child(this._network.indicators);
-        this._indicators.add_child(this._bluetooth.indicators);
         this._indicators.add_child(this._rfkill.indicators);
         this._indicators.add_child(this._volume.indicators);
         this._indicators.add_child(this._power.indicators);
@@ -830,12 +826,22 @@
         this.menu.addMenuItem(this._volume.menu);
         this.menu.addMenuItem(this._brightness.menu);
         this.menu.addMenuItem(new PopupMenu.PopupSeparatorMenuItem());
-        this.menu.addMenuItem(this._network.menu);
-        this.menu.addMenuItem(this._bluetooth.menu);
         this.menu.addMenuItem(this._rfkill.menu);
         this.menu.addMenuItem(this._power.menu);
         this.menu.addMenuItem(new PopupMenu.PopupSeparatorMenuItem());
         this.menu.addMenuItem(this._system.menu);
+        
+        if (Config.HAVE_BLUETOOTH) {
+            this._bluetooth = new imports.ui.status.bluetooth.Indicator();
+            this._indicators.add_child(this._bluetooth.indicators);
+            this.menu.addMenuItem(this._bluetooth.menu);
+        }
+        
+        if (Config.HAVE_NETWORKMANAGER) {
+            this._network = new imports.ui.status.network.NMApplet();
+            this._indicators.add_child(this._network.indicators);
+            this.menu.addMenuItem(this._network.menu);
+        }
     },
 });
 
diff -Nuar -Naur gnome-shell-3.9.90.origin/js/ui/sessionMode.js gnome-shell-3.9.90/js/ui/sessionMode.js
--- gnome-shell-3.9.90.origin/js/ui/sessionMode.js	2013-09-03 11:08:45.334010786 +0400
+++ gnome-shell-3.9.90/js/ui/sessionMode.js	2013-09-03 11:25:16.081555403 +0400
@@ -10,6 +10,8 @@
 const Main = imports.ui.main;
 const Params = imports.misc.params;
 
+const Config = imports.misc.config;
+
 const DEFAULT_MODE = 'restrictive';
 
 const _modes = {
@@ -92,7 +94,10 @@
         isLocked: false,
         isPrimary: true,
         unlockDialog: imports.ui.unlockDialog.UnlockDialog,
-        components: ['networkAgent', 'polkitAgent', 'telepathyClient',
+        components: Config.HAVE_NETWORKMANAGER ?
+                    ['networkAgent', 'polkitAgent', 'telepathyClient',
+                     'keyring', 'autorunManager', 'automountManager'] :
+                    ['polkitAgent', 'telepathyClient',
                      'keyring', 'autorunManager', 'automountManager'],
         panel: {
             left: ['activities', 'appMenu'],
diff -Nuar -Naur gnome-shell-3.9.90.origin/src/Makefile.am gnome-shell-3.9.90/src/Makefile.am
--- gnome-shell-3.9.90.origin/src/Makefile.am	2013-09-03 11:08:45.354010535 +0400
+++ gnome-shell-3.9.90/src/Makefile.am	2013-09-03 11:25:16.321552385 +0400
@@ -116,7 +116,6 @@
 	shell-invert-lightness-effect.h	\
 	shell-keybinding-modes.h	\
 	shell-mount-operation.h		\
-	shell-network-agent.h		\
 	shell-perf-log.h		\
 	shell-screenshot.h		\
 	shell-slicer.h			\
@@ -128,6 +127,10 @@
 	shell-window-tracker.h		\
 	shell-wm.h
 
+if HAVE_NETWORKMANAGER
+shell_public_headers_h +=  shell-network-agent.h
+endif
+
 shell_private_sources = 		\
 	gtkactionmuxer.h		\
 	gtkactionmuxer.c		\
@@ -165,7 +168,6 @@
 	shell-menu-tracker.c		\
 	shell-menu-tracker.h		\
 	shell-mount-operation.c		\
-	shell-network-agent.c		\
 	shell-perf-log.c		\
 	shell-polkit-authentication-agent.h	\
 	shell-polkit-authentication-agent.c	\
@@ -182,6 +184,10 @@
 	shell-wm.c			\
 	$(NULL)
 
+if HAVE_NETWORKMANAGER
+libgnome_shell_la_SOURCES +=  shell-network-agent.c
+endif
+
 libgnome_shell_la_gir_sources = \
 	$(filter-out %-private.h $(shell_private_sources), $(shell_public_headers_h) $(libgnome_shell_la_SOURCES))
 
@@ -304,7 +310,10 @@
 CLEANFILES += ShellMenu-0.1.gir
 
 Shell-0.1.gir: libgnome-shell.la St-1.0.gir ShellMenu-0.1.gir
-Shell_0_1_gir_INCLUDES = Clutter-1.0 ClutterX11-1.0 Meta-3.0 TelepathyGLib-0.12 Soup-2.4 GMenu-3.0 NetworkManager-1.0 NMClient-1.0
+Shell_0_1_gir_INCLUDES = Clutter-1.0 ClutterX11-1.0 Meta-3.0 TelepathyGLib-0.12 Soup-2.4 GMenu-3.0
+if HAVE_NETWORKMANAGER
+Shell_0_1_gir_INCLUDES += NetworkManager-1.0 NMClient-1.0
+endif
 Shell_0_1_gir_CFLAGS = $(libgnome_shell_la_CPPFLAGS) -I $(srcdir)
 Shell_0_1_gir_LIBS = libgnome-shell.la
 Shell_0_1_gir_FILES = $(libgnome_shell_la_gir_sources)
